[mysqld]
# Custom MariaDB Configuration for Shared Hosting

# Connection Settings
max_connections = {{ mariadb_max_connections | default(200) }}
max_connect_errors = {{ mariadb_max_connect_errors | default(1000) }}
wait_timeout = {{ mariadb_wait_timeout | default(300) }}
interactive_timeout = {{ mariadb_interactive_timeout | default(300) }}

# Buffer Pool Settings
innodb_buffer_pool_size = {{ mariadb_innodb_buffer_pool_size | default('1G') }}
innodb_buffer_pool_instances = {{ mariadb_innodb_buffer_pool_instances | default(4) }}
innodb_log_file_size = {{ mariadb_innodb_log_file_size | default('256M') }}
innodb_log_buffer_size = {{ mariadb_innodb_log_buffer_size | default('16M') }}

# Query Cache (MariaDB 10.x)
query_cache_type = {{ mariadb_query_cache_type | default(1) }}
query_cache_size = {{ mariadb_query_cache_size | default('64M') }}
query_cache_limit = {{ mariadb_query_cache_limit | default('2M') }}

# Table Cache
table_open_cache = {{ mariadb_table_open_cache | default(4000) }}
table_definition_cache = {{ mariadb_table_definition_cache | default(2000) }}

# Thread Settings
thread_cache_size = {{ mariadb_thread_cache_size | default(50) }}

# Sort and Join Buffers
sort_buffer_size = {{ mariadb_sort_buffer_size | default('2M') }}
read_buffer_size = {{ mariadb_read_buffer_size | default('1M') }}
read_rnd_buffer_size = {{ mariadb_read_rnd_buffer_size | default('2M') }}
join_buffer_size = {{ mariadb_join_buffer_size | default('2M') }}

# Temporary Tables
tmp_table_size = {{ mariadb_tmp_table_size | default('64M') }}
max_heap_table_size = {{ mariadb_max_heap_table_size | default('64M') }}

# Logging
slow_query_log = {{ mariadb_slow_query_log | default(1) }}
slow_query_log_file = /var/log/mariadb/slow-query.log
long_query_time = {{ mariadb_long_query_time | default(2) }}
log_queries_not_using_indexes = {{ mariadb_log_queries_not_using_indexes | default(0) }}

# Binary Logging (optional - useful for replication)
# log_bin = /var/log/mariadb/mysql-bin.log
# expire_logs_days = 7
# max_binlog_size = 100M

# Character Set
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# InnoDB Settings
innodb_file_per_table = 1
innodb_flush_log_at_trx_commit = {{ mariadb_innodb_flush_log_at_trx_commit | default(2) }}
innodb_flush_method = O_DIRECT

# Security
# Disable LOAD DATA LOCAL INFILE for security
local_infile = 0

# Performance Schema (optional - can consume resources)
performance_schema = {{ mariadb_performance_schema | default('OFF') }}

# Max Allowed Packet
max_allowed_packet = {{ mariadb_max_allowed_packet | default('64M') }}

[mysql]
# Auto-rehash for command completion
auto-rehash

[mysqldump]
quick
quote-names
max_allowed_packet = {{ mariadb_max_allowed_packet | default('64M') }}

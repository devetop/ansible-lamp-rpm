<VirtualHost *:80>
    ServerName {{ domain }}
    ServerAlias www.{{ domain }}
    ServerAdmin webmaster@{{ domain }}
    
    DocumentRoot {{ document_root }}
    
    <Directory {{ document_root }}>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    # PHP-FPM Configuration
    <FilesMatch \.php$>
        SetHandler "proxy:unix:/var/opt/remi/php{{ php_version | replace('.', '') }}/run/php-fpm/{{ username }}.sock|fcgi://localhost"
    </FilesMatch>
    
    # Proxy configuration for PHP-FPM
    <Proxy "fcgi://localhost" enablereuse=on max=10>
    </Proxy>
    
    # Logging
    ErrorLog /var/log/httpd/{{ username }}-{{ domain }}-error.log
    CustomLog /var/log/httpd/{{ username }}-{{ domain }}-access.log combined
    
    # Security Headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    
</VirtualHost>

# SSL VirtualHost (placeholder - requires SSL certificate)
<VirtualHost *:443>
    ServerName {{ domain }}
    ServerAlias www.{{ domain }}
    ServerAdmin webmaster@{{ domain }}
    
    DocumentRoot {{ document_root }}
    
    <Directory {{ document_root }}>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    # PHP-FPM Configuration
    <FilesMatch \.php$>
        SetHandler "proxy:unix:/var/opt/remi/php{{ php_version | replace('.', '') }}/run/php-fpm/{{ username }}.sock|fcgi://localhost"
    </FilesMatch>
    
    # Proxy configuration for PHP-FPM
    <Proxy "fcgi://localhost" enablereuse=on max=10>
    </Proxy>
    
    # SSL Configuration (update with actual certificates)
    # SSLEngine on
    # SSLCertificateFile /etc/pki/tls/certs/{{ domain }}.crt
    # SSLCertificateKeyFile /etc/pki/tls/private/{{ domain }}.key
    # SSLCertificateChainFile /etc/pki/tls/certs/{{ domain }}-chain.crt
    
    # Logging
    ErrorLog /var/log/httpd/{{ username }}-{{ domain }}-ssl-error.log
    CustomLog /var/log/httpd/{{ username }}-{{ domain }}-ssl-access.log combined
    
    # Security Headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    
</VirtualHost>
